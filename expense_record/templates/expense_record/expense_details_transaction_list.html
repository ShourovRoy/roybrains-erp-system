{% extends 'base.html' %}

{% block content %}
<section class="py-4 bg-dark text-light min-vh-100" style="background-color: #1a1d20 !important;">
    <div class="container">

        <div class="card bg-body-tertiary border-0 shadow-sm mb-4 overflow-hidden" style="background-color: #2b3035 !important;">
            <div class="d-flex">
                <div class="bg-primary opacity-75" style="width: 6px;"></div>
                <div class="card-body p-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <label class="x-small-label text-primary text-uppercase tracking-widest d-block mb-1">Expense Book Ledger</label>
                            <h3 class="fw-bold text-white mb-1">{{ expense_details.name }}</h3>
                            <p class="text-secondary small mb-0">{{ expense_details.description }}</p>
                        </div>
                        <div class="col-md-4 text-md-end mt-3 mt-md-0">
                            <span class="text-secondary x-small d-block">Established On</span>
                            <span class="text-white fw-semibold">{{ expense_details.created_at|date:"d M Y" }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <div class="card bg-body-tertiary border-0 shadow-sm h-100" style="background-color: #2b3035 !important;">
                    <div class="card-body">
                        <label class="x-small-label text-secondary text-uppercase d-block mb-2">Lifetime Expense</label>
                        <h3 class="fw-bold text-danger mb-0">৳ {{ life_time_expense|floatformat:2 }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-body-tertiary border-0 shadow-sm h-100" style="background-color: #2b3035 !important;">
                    <div class="card-body">
                        <label class="x-small-label text-secondary text-uppercase d-block mb-2">
                            {% if filtered %}Filtered Period{% else %}Today's Outflow{% endif %}
                        </label>
                        <h3 class="fw-bold text-warning mb-0">৳ {{ today_expense|floatformat:2 }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card bg-body-tertiary border-0 shadow-sm h-100" style="background-color: #2b3035 !important;">
                    <div class="card-body">
                        <label class="x-small-label text-secondary text-uppercase d-block mb-2">Annual Total</label>
                        <h3 class="fw-bold text-info mb-0">৳ {{ yearly_expense|floatformat:2 }}</h3>
                    </div>
                </div>
            </div>
        </div>

        <form action="{% url 'expense_record:expense-book-details' expense_details.pk  %}" method="get" class="card bg-body-tertiary border-0 mb-4" style="background-color: #2b3035 !important;">
            <div class="card-body p-4">
                <div class="row g-3 align-items-end">
                    <div class="col-md-4">
                        <label class="x-small-label text-secondary text-uppercase mb-2 d-block">From Date</label>
                        <input type="date" name="start_date" class="form-control bg-dark text-white border-secondary border-opacity-25 py-2" style="background-color: #1a1d20 !important;" value="{{ request.GET.start_date }}">
                    </div>
                    <div class="col-md-4">
                        <label class="x-small-label text-secondary text-uppercase mb-2 d-block">To Date</label>
                        <input type="date" name="end_date" class="form-control bg-dark text-white border-secondary border-opacity-25 py-2" style="background-color: #1a1d20 !important;" value="{{ request.GET.end_date }}">
                    </div>
                    <div class="col-md-4 d-flex gap-2">
                        <button type="submit" class="btn btn-primary w-100 fw-bold">Filter Ledger</button>
                        {% if filtered %}
                        <a href="{% url 'expense_record:expense-book-details' expense_details.pk  %}" class="btn btn-outline-secondary w-50 fw-bold">Clear</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </form>

        <div class="card bg-body-tertiary border-0 shadow-sm overflow-hidden" style="background-color: #2b3035 !important;">
            <div class="card-header bg-black bg-opacity-10 border-bottom border-secondary border-opacity-10 p-3">
                <h5 class="mb-0 fw-bold text-white small text-uppercase tracking-wider">Expense Transactions</h5>
            </div>
            <div class="table-responsive">
                <table class="table table-dark mb-0 align-middle shadow-none">
                    <thead class="x-small-label text-secondary text-uppercase" style="background-color: rgba(0,0,0,0.15);">
                        <tr>
                            <th class="ps-4 py-3">Date</th>
                            <th class="py-3">Description</th>
                            <th class="py-3 text-center">Status</th>
                            <th class="py-3 text-end">Debit (In)</th>
                            <th class="py-3 text-end pe-4">Credit (Out)</th>
                        </tr>
                    </thead>
                    <tbody class="border-0">
                        {% for expense in expense_transactions %}
                        <tr class="border-bottom border-secondary border-opacity-10">
                            <td class="ps-4 py-3">
                                <span class="text-white fw-semibold">{{ expense.date|date:"d M Y" }}</span>
                            </td>
                            <td class="py-3 text-secondary small">{{ expense.description }}</td>
                            <td class="py-3 text-center">
                                <span class="pill-tag pill-success-sm">{{ expense.status }}</span>
                            </td>
                            <td class="py-3 text-end text-success fw-bold">৳ {{ expense.debit|default:"0.00" }}</td>
                            <td class="py-3 text-end text-warning fw-bold pe-4">৳ {{ expense.credit|default:"0.00" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center text-secondary py-5 italic">No transactions recorded for this period.</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        {% if page_obj.paginator.num_pages > 1 %}
        <nav class="py-4">
            <ul class="pagination justify-content-center gap-2">
                {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link border-0 bg-body-tertiary text-secondary rounded-3 px-3" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page=1">First</a></li>
                {% endif %}
                
                <li class="page-item active"><span class="page-link border-0 bg-primary rounded-3 px-3">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span></li>

                {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link border-0 bg-body-tertiary text-secondary rounded-3 px-3" href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}page={{ page_obj.next_page_number }}">Next</a></li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}

    </div>
</section>

<style>
    /* THEME FOUNDATION */
    .x-small-label { font-size: 0.65rem; font-weight: 800; letter-spacing: 1.2px; }
    .x-small { font-size: 0.75rem; }
    .italic { font-style: italic; }
    .tracking-widest { letter-spacing: 2px; }

    /* Table Styling */
    .table-dark { background-color: transparent !important; }
    .table td, .table th { border: none; }
    
    /* Pill Tags */
    .pill-tag {
        padding: 3px 12px;
        border-radius: 50px;
        font-size: 0.65rem;
        font-weight: 800;
        text-transform: uppercase;
        background-color: rgba(40, 167, 69, 0.1);
        color: #28a745;
        border: 1px solid rgba(40, 167, 69, 0.2);
    }

    /* Input & Date Match */
    .form-control:focus {
        background-color: #1a1d20 !important;
        border-color: var(--bs-primary) !important;
        box-shadow: none;
        color: white;
    }
    input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(1); opacity: 0.5; }

    /* Button Consistency */
    .btn-primary { background-color: var(--bs-primary); border: none; padding: 10px 20px; }
    .btn-outline-secondary { border: 1px solid rgba(255,255,255,0.1); color: #888; }
    .btn-outline-secondary:hover { background: rgba(255,255,255,0.05); color: #fff; }
</style>
{% endblock content %}