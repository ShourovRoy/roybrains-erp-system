{% extends 'base.html' %} {% block content %}
<section class="py-5 bg-dark text-light min-vh-100">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-7">
        <div class="mb-3">
          <a
            href="{% url 'ledger-list' %}"
            class="text-secondary text-decoration-none small"
          >
            <i class="bi bi-arrow-left me-1"></i> Back to Ledger List
          </a>
        </div>

        <div class="card bg-body-tertiary border-0 shadow-lg">
          <div class="card-header bg-primary bg-gradient py-3">
            <h4 class="card-title mb-0 fw-bold text-white text-center">
              <i class="bi bi-person-plus-fill me-2"></i>Create New Ledger
              Account
            </h4>
          </div>

          <div class="card-body p-4 p-md-5">
            <form action="{% url 'create-ledger' %}" method="post">
              {% csrf_token %} {{ form.form_management }}

              <div class="row g-4">
                <div class="col-12">
                  <label
                    class="form-label fw-semibold text-secondary small text-uppercase"
                  >
                    <i class="bi bi-person me-1"></i>
                    {{ form.account_name.label }}
                  </label>
                  <div class="input-group custom-dark-input">
                    {{ form.account_name }}
                  </div>
                </div>

                <div class="col-md-6">
                  <label
                    class="form-label fw-semibold text-secondary small text-uppercase"
                  >
                    <i class="bi bi-telephone me-1"></i>
                    {{ form.phone_number.label }}
                  </label>
                  {{ form.phone_number }}
                </div>

                <div class="col-md-6">
                  <label
                    class="form-label fw-semibold text-secondary small text-uppercase"
                  >
                    <i class="bi bi-tags me-1"></i>{{ form.account_type.label }}
                  </label>
                  {{ form.account_type }}
                </div>

                <div class="col-12 bank_account_number">
                  <label
                    class="form-label fw-semibold text-info small text-uppercase"
                  >
                    <i class="bi bi-bank me-1"></i>
                    {{ form.bank_account_number.label }}
                  </label>
                  {{ form.bank_account_number }}
                  <div class="form-text text-info x-small">
                    Required only for Bank accounts
                  </div>
                </div>

                <div class="col-12 branch">
                  <label
                    class="form-label fw-semibold text-info small text-uppercase"
                  >
                    <i class="bi bi-bank me-1"></i>{{ form.branch.label }}
                  </label>
                  {{ form.branch }}
                  <div class="form-text text-info x-small">
                    Required only for Bank accounts
                  </div>
                </div>

                <div class="col-12">
                  <label
                    class="form-label fw-semibold text-secondary small text-uppercase"
                  >
                    <i class="bi bi-geo-alt me-1"></i>{{ form.address.label }}
                  </label>
                  {{ form.address }}
                </div>

                <div class="col-12 pt-3">
                  <button
                    class="btn btn-primary w-100 fw-bold py-2 shadow-sm"
                    type="submit"
                  >
                    Save Account Information
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>

        <p class="text-center text-secondary mt-4 small">
          All financial balances are recorded in
          <strong>Bangladeshi Taka (à§³)</strong>
        </p>
      </div>
    </div>
  </div>
</section>

<style>
  /* Styling Django's default rendered inputs to match Bootstrap Dark Mode */
  input,
  select,
  textarea {
    display: block;
    width: 100%;
    padding: 0.375rem 0.75rem;
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #fff;
    background-color: #1a1d20 !important;
    background-clip: padding-box;
    border: 1px solid #495057 !important;
    border-radius: 8px;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
  }

  input:focus,
  select:focus,
  textarea:focus {
    border-color: #0d6efd !important;
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
  }

  .bg-body-tertiary {
    background-color: #2b3035 !important;
  }
  .x-small {
    font-size: 0.75rem;
  }
</style>

<script>
  // Logic remains unchanged to ensure zero breakage
  document.addEventListener("DOMContentLoaded", () => {
    let branch = document.querySelector(".branch");
    let branchInput = document.getElementById("id_branch");
    let bankAccountNumber = document.querySelector(".bank_account_number");
    let bankAccountNumberInput = document.getElementById(
      "id_bank_account_number"
    );
    let accountTypeInput = document.getElementById("id_account_type");

    // Initial state
    branch.style.display = "none";
    bankAccountNumber.style.display = "none";
    branchInput.removeAttribute("required");
    bankAccountNumberInput.removeAttribute("required");

    if (accountTypeInput) {
      accountTypeInput.addEventListener("input", () => {
        let accountTypeValue = accountTypeInput.value;

        if (accountTypeValue === "Bank") {
          branch.style.display = "block"; // Changed 'inline' to 'block' for better Bootstrap layout
          branchInput.setAttribute("required", true);
          bankAccountNumber.style.display = "block";
          bankAccountNumberInput.setAttribute("required");
        } else {
          branch.style.display = "none";
          branchInput.removeAttribute("required");
          bankAccountNumber.style.display = "none";
          bankAccountNumberInput.removeAttribute("required");
        }
      });
    }
  });
</script>
{% endblock content %}
